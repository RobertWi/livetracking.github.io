<!DOCTYPE HTML>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="noindex, nofollow">
<title>Demo - livetracking.io</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.3/leaflet.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.4/numeral.min.js"></script>
<script src="https://www.amcharts.com/lib/3/amcharts.js"></script>
<script src="https://www.amcharts.com/lib/3/serial.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.3/leaflet.js"></script>
<style>
#samples-chart {
	width: 100%;
	height: 500px;
}
#samples-map {
	width: 100%;
	height: 600px;
}
</style>
</head>
<body>
<nav class="navbar navbar-default navbar-static-top">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand logo" href="https://livetracking.io/">
				livetracking.io
			</a>
		</div>
		<div id="navbar" class="navbar-collapse collapse">
			<ul class="nav navbar-nav navbar-right">
				<li>
					<a href="#">
						<i class="fa fa-clock-o" aria-hidden="true"></i>
						Last 30m
					</a>
				</li>
				<li>
					<a href="#">
						<i class="fa fa-refresh" aria-hidden="true"></i>
						Refresh every 3s
					</a>
				</li>
			</ul>
		</div>
	</div>
</nav>

<div class="container-fluid">

<div class="row">
	<div class="col-md-12">
		<div class="page-header">
			<h1>Demo</h1>
		</div>
	</div>
</div>

<div class="row">
<div class="col-md-12">
	<div class="alert alert-info" role="alert" id="waiting">
		Waiting for data...
	</div>
	<div class="alert alert-danger hidden" role="alert" id="error">
		Can not retrieve data!
	</div>
</div>
</div>

<div class="row">
	
	<div class="hidden col-md-2" id="battery" >
		<div class="panel panel-default">
			<div class="panel-body">
				<i class="fa fa-battery-three-quarters" aria-hidden="true"></i>
				<span id="last_battery">80</span> %
			</div>
		</div>
	</div>
	
	<div class="hidden col-md-2" id="gsm_signal">
		<div class="panel panel-default">
			<div class="panel-body">
				<i class="fa fa-signal" aria-hidden="true"></i>
				<span id="last_gsm_signal">60</span> %
			</div>
		</div>
	</div>
	
</div>

<div class="row">

<div class="col-lg-4 col-md-12">

<div class="panel panel-default hidden" id="mean">
<div class="panel-heading">
	<h3 class="panel-title">Average</h3>
</div>
<div class="panel-body">
	<table class="table table-hover">
	<thead>
	<tr><th></th><th>3sec</th><th>1min</th><th>5min</th><th>10min</th></tr>
	</thead>
	<tbody>
	<tr id="mean_spd_kph" class="hidden">
		<th>
			<i class="fa fa-tachometer" aria-hidden="true"></i>
			Speed (kph)
		</th>
		<td id="mean_spd_kph_3s"></td>
		<td id="mean_spd_kph_1m"></td>
		<td id="mean_spd_kph_5m"></td>
		<td id="mean_spd_kph_10m"></td>
	</tr>
	<tr id="mean_hr_bpm" class="hidden">
		<th>
			<i class="fa fa-heart" aria-hidden="true"></i>
			Heartrate (bpm)
		</th>
		<td id="mean_hr_bpm_3s"></td>
		<td id="mean_hr_bpm_1m"></td>
		<td id="mean_hr_bpm_5m"></td>
		<td id="mean_hr_bpm_10m"></td>
	</tr>
	<tr id="mean_cad_rpm" class="hidden">
		<th>
			<i class="fa fa-repeat" aria-hidden="true"></i>
			Cadence (rpm)
		</th>
		<td id="mean_cad_rpm_3s"></td>
		<td id="mean_cad_rpm_1m"></td>
		<td id="mean_cad_rpm_5m"></td>
		<td id="mean_cad_rpm_10m"></td>
	</tr>
	<tr id="mean_pwr_w" class="hidden">
		<th>
			<i class="fa fa-bolt" aria-hidden="true"></i>
			Power (W)
		</th>
		<td id="mean_pwr_w_3s"></td>
		<td id="mean_pwr_w_1m"></td>
		<td id="mean_pwr_w_5m"></td>
		<td id="mean_pwr_w_10m"></td>
	</tr>
	</tbody>
	</table>
	</div>
</div>

</div> <!-- // col -->

<div class="col-lg-4 col-md-6">
	
<div class="panel panel-default hidden" id="max">
<div class="panel-heading">
	<h3 class="panel-title">Maximum</h3>
</div>
<div class="panel-body">
	<table class="table table-hover">
	<thead>
	<tr><th></th><th>3sec</th><th>1min</th><th>5min</th><th>10min</th></tr>
	</thead>
	<tbody>
	<tr id="max_spd_kph" class="hidden">
		<th>Speed</th>
		<td id="max_spd_kph_3s"></td>
		<td id="max_spd_kph_1m"></td>
		<td id="max_spd_kph_5m"></td>
		<td id="max_spd_kph_10m"></td>
	</tr>
	<tr id="max_hr_bpm" class="hidden">
		<th>Heartrate</th>
		<td id="max_hr_bpm_3s"></td>
		<td id="max_hr_bpm_1m"></td>
		<td id="max_hr_bpm_5m"></td>
		<td id="max_hr_bpm_10m"></td>
	</tr>
	<tr id="max_cad_rpm" class="hidden">
		<th>Cadence</th>
		<td id="max_cad_rpm_3s"></td>
		<td id="max_cad_rpm_1m"></td>
		<td id="max_cad_rpm_5m"></td>
		<td id="max_cad_rpm_10m"></td>
	</tr>
	<tr id="max_pwr_w" class="hidden">
		<th>Power</th>
		<td id="max_pwr_w_3s"></td>
		<td id="max_pwr_w_1m"></td>
		<td id="max_pwr_w_5m"></td>
		<td id="max_pwr_w_10m"></td>
	</tr>
	</tbody>
	</table>
	</div>
</div>

</div> <!-- // col -->

<div class="col-lg-4 col-md-6">

<div class="panel panel-default hidden" id="min">
<div class="panel-heading">
	<h3 class="panel-title">Minimum</h3>
</div>
<div class="panel-body">
	<table class="table table-hover">
	<thead>
	<tr><th></th><th>3sec</th><th>1min</th><th>5min</th><th>10min</th></tr>
	</thead>
	<tbody>
	<tr id="min_spd_kph" class="hidden">
		<th>Speed</th>
		<td id="min_spd_kph_3s"></td>
		<td id="min_spd_kph_1m"></td>
		<td id="min_spd_kph_5m"></td>
		<td id="min_spd_kph_10m"></td>
	</tr>
	<tr id="min_hr_bpm" class="hidden">
		<th>Heartrate</th>
		<td id="min_hr_bpm_3s"></td>
		<td id="min_hr_bpm_1m"></td>
		<td id="min_hr_bpm_5m"></td>
		<td id="min_hr_bpm_10m"></td>
	</tr>
	<tr id="min_cad_rpm" class="hidden">
		<th>Cadence</th>
		<td id="min_cad_rpm_3s"></td>
		<td id="min_cad_rpm_1m"></td>
		<td id="min_cad_rpm_5m"></td>
		<td id="min_cad_rpm_10m"></td>
	</tr>
	<tr id="min_pwr_w" class="hidden">
		<th>Power</th>
		<td id="min_pwr_w_3s"></td>
		<td id="min_pwr_w_1m"></td>
		<td id="min_pwr_w_5m"></td>
		<td id="min_pwr_w_10m"></td>
	</tr>
	</tbody>
	</table>
	</div>
</div>

</div> <!-- // col -->

</div> <!-- row -->

<div class="row">
<div class="col-md-12"><div id="samples-map"></div></div>
</div>

<div class="row">
<div class="col-md-12"><div id="samples-chart"></div></div>
</div>

</div> <!-- // container -->

<script>
var username = 'demo';
var timer = 1800; // load 30 min
var token = btoa('public:livetracking'); // login
var data_chart = [];
var data_map   = [];
var axisLeft   = 0;
var axisRight  = 0;

/***
 * Chart
 *
 */
var samples_chart = new AmCharts.AmSerialChart();
samples_chart.dataProvider = data_chart;
samples_chart.categoryField = "time";
// Axes
samples_chart.categoryAxis = {
	startOnAxis: true,
	parseDates : true,
	minPeriod : 'ss',
	dashLength : 2,
	gridAlpha : 0.15,
	boldPeriodBeginning : false,
	axisColor : "#DADADA"
};
samples_chart.dataDateFormat = "JJ:NN:SS";
// Cursor
var chartCursor = new AmCharts.ChartCursor();
chartCursor.cursorPosition = "mouse";
chartCursor.cursorColor = "#428BCA";
chartCursor.pan = true; // no select
chartCursor.categoryBalloonDateFormat = "JJ:NN:SS";
samples_chart.addChartCursor(chartCursor);
// Legend
var legend = new AmCharts.AmLegend();
legend.equalWidths = false;
legend.valueWidth = 0;
samples_chart.addLegend(legend);
// Write
samples_chart.write('samples-chart');

/***
 * Map
 *
 */
var map = L.map('samples-map', {
	center: [53.550556, 9.993333],
	zoom: 13,
	scrollWheelZoom: false
});

L.tileLayer('https://tiles.wmflabs.org/osm/{z}/{x}/{y}.png', {
	attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

var route = L.polyline([[53.550556, 9.993333],[53.550556, 9.993333]]).addTo(map);
var marker = L.marker([53.550556, 9.993333]).addTo(map);

// Altitude
var show_chart_alt_m = false;
function chart_alt_m() {
	var axisHm = new AmCharts.ValueAxis();
	axisHm.position = "right";
	axisHm.axisColor = "#CCCCCC";
	axisHm.axisThickness = 0;
	axisHm.gridAlpha = 0;
	axisHm.labelFunction = function(){return''};
	var graphHm = new AmCharts.AmGraph();
	graphHm.valueAxis = axisHm;
	graphHm.type = "smoothedLine";
	graphHm.lineColor = "#CCCCCC";
	graphHm.title = "Altitude";
	graphHm.valueField = "alt_m";
	graphHm.bullet = "none";
	graphHm.fillAlphas = 1;
	graphHm.balloonText = "[[value]] m";
	samples_chart.addValueAxis(axisHm);
	samples_chart.addGraph(graphHm);
}

// Speed
var show_chart_spd_kph = false;
function chart_spd_kph() {
	axisKmh = new AmCharts.ValueAxis();
	axisKmh.position = "left";
	axisKmh.gridAlpha = 0;
	axisKmh.axisColor = "#428BCA";
	axisKmh.axisThickness = 1;
	axisKmh.fontSize = 8;
	var graphKmh = new AmCharts.AmGraph();
	graphKmh.valueAxis = axisKmh;
	graphKmh.lineColor = "#428BCA";
	graphKmh.lineThickness = 1;
	graphKmh.title = "Speed";
	graphKmh.valueField = "spd_kph";
	graphKmh.bullet = "none";
	graphKmh.balloonText = "[[value]] kph";
	axisKmh.offset = axisLeft * 35;
	axisLeft = axisLeft + 1;
	samples_chart.addValueAxis(axisKmh);
	samples_chart.addGraph(graphKmh);
}

// Heart Rate
var show_chart_hr_bpm = false;
function chart_hr_bpm() {
	var axisPuls = new AmCharts.ValueAxis();
	axisPuls.position = "left";
	axisPuls.axisColor = "#D9534F";
	axisPuls.gridAlpha = 0;
	axisPuls.axisThickness = 1;
	axisPuls.fontSize = 8;
	var graphPuls = new AmCharts.AmGraph();
	graphPuls.valueAxis = axisPuls;
	graphPuls.lineColor = "#D9534F";
	graphPuls.lineThickness = 1;
	graphPuls.title = "Heart Rate";
	graphPuls.valueField = "hr_bpm";
	graphPuls.bullet = "none";
	graphPuls.balloonText = "[[value]] bpm";
	axisPuls.offset = axisLeft * 35;
	axisLeft = axisLeft + 1;
	samples_chart.addValueAxis(axisPuls);
	samples_chart.addGraph(graphPuls);
}

// Cadence
var show_chart_cad_rpm = false;
function chart_cad_rpm() {
	var axisTritt = new AmCharts.ValueAxis();
	axisTritt.position = "right";
	axisTritt.axisColor = "#F0AD4E";
	axisTritt.gridAlpha = 0;
	axisTritt.axisThickness = 1;
	axisTritt.fontSize = 8;
	var graphTritt = new AmCharts.AmGraph();
	graphTritt.valueAxis = axisTritt;
	graphTritt.lineColor = "#F0AD4E";
	graphTritt.lineThickness = 1;
	graphTritt.title = "Cadence";
	graphTritt.valueField = "cad_rpm";
	graphTritt.bullet = "none";
	graphTritt.balloonText = "[[value]] rpm";
	axisTritt.offset = axisRight * 35;
	axisRight = axisRight + 1;
	samples_chart.addValueAxis(axisTritt);
	samples_chart.addGraph(graphTritt);
}

// Power
var show_chart_pwr_w = false;
function chart_pwr_w(){
	var axisWatt = new AmCharts.ValueAxis();
	axisWatt.position = "right";
	axisWatt.axisColor = "#5BC0DE";
	axisWatt.gridAlpha = 0;
	axisWatt.axisThickness = 1;
	axisWatt.fontSize = 8;
	var graphWatt = new AmCharts.AmGraph();
	graphWatt.valueAxis = axisWatt;
	graphWatt.lineColor = "#5BC0DE";
	graphWatt.lineThickness = 1;
	graphWatt.title = "Power";
	graphWatt.valueField = "pwr_w";
	graphWatt.bullet = "none";
	graphWatt.balloonText = "[[value]] W";
	axisWatt.offset = axisRight * 35;
	axisRight = axisRight + 1;
	samples_chart.addValueAxis(axisWatt);
	samples_chart.addGraph(graphWatt);
}




var query_sql = 'SELECT LAST(battery), LAST(gsm_signal), LAST(spd_kph) FROM samples WHERE time > now() - 10m;'+ // results: 0
'SELECT MIN(spd_kph), MEAN(spd_kph), MAX(spd_kph) FROM samples WHERE time > now() - 3s;'+  // results: 1,  spd_kph 3 sec
'SELECT MIN(spd_kph), MEAN(spd_kph), MAX(spd_kph) FROM samples WHERE time > now() - 1m;'+  // results: 2,  spd_kph 1 min
'SELECT MIN(spd_kph), MEAN(spd_kph), MAX(spd_kph) FROM samples WHERE time > now() - 5m;'+  // results: 3,  spd_kph 5 min
'SELECT MIN(spd_kph), MEAN(spd_kph), MAX(spd_kph) FROM samples WHERE time > now() - 10m;'+ // results: 4   spd_kph 10 min
'SELECT MIN(hr_bpm), MEAN(hr_bpm), MAX(hr_bpm) FROM samples WHERE time > now() - 3s;'+     // results: 5,  hr_bpm 3 sec
'SELECT MIN(hr_bpm), MEAN(hr_bpm), MAX(hr_bpm) FROM samples WHERE time > now() - 1m;'+     // results: 6,  hr_bpm 1 min
'SELECT MIN(hr_bpm), MEAN(hr_bpm), MAX(hr_bpm) FROM samples WHERE time > now() - 5m;'+     // results: 7,  hr_bpm 5 min
'SELECT MIN(hr_bpm), MEAN(hr_bpm), MAX(hr_bpm) FROM samples WHERE time > now() - 10m;'+    // results: 8,  hr_bpm 10 min
'SELECT MIN(cad_rpm), MEAN(cad_rpm), MAX(cad_rpm) FROM samples WHERE time > now() - 3s;'+  // results: 9,  cad_rpm 3 sec
'SELECT MIN(cad_rpm), MEAN(cad_rpm), MAX(cad_rpm) FROM samples WHERE time > now() - 1m;'+  // results: 10, cad_rpm 1 min
'SELECT MIN(cad_rpm), MEAN(cad_rpm), MAX(cad_rpm) FROM samples WHERE time > now() - 5m;'+  // results: 11, cad_rpm 5 min
'SELECT MIN(cad_rpm), MEAN(cad_rpm), MAX(cad_rpm) FROM samples WHERE time > now() - 10m;'+ // results: 12, cad_rpm 10 min
'SELECT MIN(pwr_w), MEAN(pwr_w), MAX(pwr_w) FROM samples WHERE time > now() - 3s;'+        // results: 13, pwr_w 3 sec
'SELECT MIN(pwr_w), MEAN(pwr_w), MAX(pwr_w) FROM samples WHERE time > now() - 1m;'+        // results: 14, pwr_w 1 min
'SELECT MIN(pwr_w), MEAN(pwr_w), MAX(pwr_w) FROM samples WHERE time > now() - 5m;'+        // results: 15, pwr_w 5 min
'SELECT MIN(pwr_w), MEAN(pwr_w), MAX(pwr_w) FROM samples WHERE time > now() - 10m;'+       // results: 16, pwr_w 10 min
'SELECT '+ // results: 17, values: n
'lat,'+        // 1
'lng,'+        // 2
'acc_m,'+      // 3
'battery,'+    // 4
'gsm_signal,'+ // 5
'temp_c,'+     // 6
'spd_kph,'+    // 7
'alt_m,'+      // 8
'hr_bpm,'+     // 9
'cad_rpm,'+    // 10
'pwr_w,'+      // 11
'pwr_w_l,'+    // 12
'pwr_w_r'+     // 13
' FROM samples'; // WHERE time > now() - Xs


/***
 * Format
 *
 */

function acc_m(meter) {
	if (meter && meter > 0){
		return numeral(meter).format('0')
	} else {
		return 0
	}
}

function battery(percent) {
	if (percent && percent > 0){
		return numeral(percent).format('0')
	} else {
		return 0
	}
}

function gsm_signal(percent) {
	if (percent && percent > 0){
		return numeral(percent).format('0')
	} else {
		return 0
	}
}

function temp_c(celsius) {
	if (celsius && (celsius > 0 || celsius < 0)){
		return numeral(celsius).format('0.00')
	} else {
		return 0
	}
}


function spd_kph(kph) {
	if (kph && kph > 0){
		return numeral(kph).format('0.00')
	} else {
		return 0
	}
}

function alt_m(meter) {
	if (meter && meter > 0){
		return numeral(meter).format('0')
	} else {
		return 0
	}
}

function hr_bpm(bpm) {
	if (bpm && bpm > 0){
		return numeral(bpm).format('0')
	} else {
		return 0
	}
}

function cad_rpm(rpm) {
	if (rpm && rpm > 0){
		return numeral(rpm).format('0')
	} else {
		return 0
	}
}

function pwr_w(watt) {
	if (watt && watt > 0){
		return numeral(watt).format('0')
	} else {
		return 0
	}
}


/***
 * Helper
 *
 */

function online(){
	$("#error").addClass("hidden");
	document.title = '▶️️ ' + username + ' - livetracking.io';
}

function offline(){
	$("#waiting").addClass("hidden");
	$("#error").removeClass("hidden");
	document.title = '⏸️ ' + username + ' - livetracking.io';
}


/***
 * Query InfluxDB (output.livetracking.io)
 *
 */

function query() {
	$.ajax({
		dataType: "json",
		method: "GET",
		beforeSend: function (xhr) {
			xhr.setRequestHeader ("Authorization", "Basic " + token);
		},
		url: 'https://output.livetracking.io/query',
		data: {
			db: username,
			epoch: 's',
			q: query_sql + ' WHERE time > now() - ' + timer + 's;'
		},
		crossDomain: true
	}).error(function(xhr){
		offline();
		timer = timer + 3; // set timer + 1 sec
	}).success(function(json){
		online();
		timer = 3; // reset timer to 1 sec
		query_result(json);
	});
}

function query_result(json){
	if (json['results']){
		// battery and gsm signal
		if (json['results']['0']['series']) {
			if (json['results']['0']['series']['0']['values']) {
				// battery
				$("#last_battery").html(battery(json['results']['0']['series']['0']['values']['0']['1']))
				// gsm_signal
				$("#last_gsm_signal").html(gsm_signal(json['results']['2']['series']['0']['values']['0']['2']))
			}
		}
		// samples
		if (json['results']['17']['series']){
			if (json['results']['17']['series']['0']['values']) {
				$("#waiting").addClass("hidden");
				results_length = json['results']['17']['series']['0']['values'].length
				for (var i = 0; i < results_length; i++) {
					sample = json['results']['17']['series']['0']['values'][i];
					// Array for line chart data
					var seconds = sample['0'];
					var milliseconds = seconds*1000;
					var d = new Date(milliseconds);
					data_chart.push({
						time       : d,
						acc_m      : acc_m(sample['3']),
						battery    : battery(sample['4']),
						gsm_signal : gsm_signal(sample['5']),
						temp_c     : temp_c(sample['6']),
						spd_kph    : spd_kph(sample['7']),
						alt_m      : alt_m(sample['8']),
						hr_bpm     : hr_bpm(sample['9']),
						cad_rpm    : cad_rpm(sample['10']),
						pwr_w      : pwr_w(sample['11']),
						pwr_w_l    : pwr_w(sample['12']),
						pwr_w_r    : pwr_w(sample['13'])
					});
					
					// Array for map data
					if (sample['1'] && sample['2']) {
						data_map.push(
							[ sample['1'], sample['2'] ]
						);
					}
					
					// Remove first item from array if > 30 min (1800 sec)
					if (data_map.length > 1800) {
						data_map.shift();
					}
					if (data_chart.length > 1800) {
						data_chart.shift();
					}
				}
			}
			// Update chart
			samples_chart.validateData();
			// Update map
			marker.removeFrom(map); // Remove marker
			route.removeFrom(map);
			marker = L.marker(data_map[data_map.length-1]).addTo(map); // Add marker
			route = L.polyline(data_map).addTo(map);
			map.setView(data_map[data_map.length-1]); // Center view, but not zoom
		}
		// spd_kph
		if (json['results']['4']['series'] && json['results']['4']['series']['0']['values']['0']['2']){
			$("#mean").removeClass("hidden");
			$("#min").removeClass("hidden");
			$("#max").removeClass("hidden");
			$("#mean_spd_kph").removeClass("hidden");
			$("#min_spd_kph").removeClass("hidden");
			$("#max_spd_kph").removeClass("hidden");
			if (!show_chart_spd_kph) {
				chart_spd_kph();
				show_chart_spd_kph = true;
			}
			// 3 sec
			if (json['results']['1']['series']) {
				if (json['results']['1']['series']['0']['values']) {
					// min
					$("#min_spd_kph_3s").html(spd_kph(json['results']['1']['series']['0']['values']['0']['1']))
					// mean
					$("#mean_spd_kph_3s").html(spd_kph(json['results']['1']['series']['0']['values']['0']['2']))
					// max
					$("#max_spd_kph_3s").html(spd_kph(json['results']['1']['series']['0']['values']['0']['3']))
				}
			}
			// 1 min
			if (json['results']['2']['series']) {
				if (json['results']['2']['series']['0']['values']) {
					// min
					$("#min_spd_kph_1m").html(spd_kph(json['results']['2']['series']['0']['values']['0']['1']))
					// mean
					$("#mean_spd_kph_1m").html(spd_kph(json['results']['2']['series']['0']['values']['0']['2']))
					// max
					$("#max_spd_kph_1m").html(spd_kph(json['results']['2']['series']['0']['values']['0']['3']))
				}
			}
			// 5 min
			if (json['results']['3']['series']) {
				if (json['results']['3']['series']['0']['values']) {
					// min
					$("#min_spd_kph_5m").html(spd_kph(json['results']['3']['series']['0']['values']['0']['1']))
					// mean
					$("#mean_spd_kph_5m").html(spd_kph(json['results']['3']['series']['0']['values']['0']['2']))
					// max
					$("#max_spd_kph_5m").html(spd_kph(json['results']['3']['series']['0']['values']['0']['3']))
				}
			}
			// 10 min
			if (json['results']['4']['series']) {
				if (json['results']['4']['series']['0']['values']) {
					// min
					$("#min_spd_kph_10m").html(spd_kph(json['results']['4']['series']['0']['values']['0']['1']))
					// mean
					$("#mean_spd_kph_10m").html(spd_kph(json['results']['4']['series']['0']['values']['0']['2']))
					// max
					$("#max_spd_kph_10m").html(spd_kph(json['results']['4']['series']['0']['values']['0']['3']))
				}
			}
		}
		// hr_bpm
		if (json['results']['8']['series'] && json['results']['8']['series']['0']['values']['0']['2']){
			$("#mean").removeClass("hidden");
			$("#min").removeClass("hidden");
			$("#max").removeClass("hidden");
			$("#mean_hr_bpm").removeClass("hidden");
			$("#min_hr_bpm").removeClass("hidden");
			$("#max_hr_bpm").removeClass("hidden");
			if (!show_chart_hr_bpm) {
				chart_hr_bpm();
				show_chart_hr_bpm = true;
			}
			// 3 sec
			if (json['results']['5']['series']) {
				if (json['results']['5']['series']['0']['values']) {
					// min
					$("#min_hr_bpm_3s").html(hr_bpm(json['results']['5']['series']['0']['values']['0']['1']))
					// mean
					$("#mean_hr_bpm_3s").html(hr_bpm(json['results']['5']['series']['0']['values']['0']['2']))
					// max
					$("#max_hr_bpm_3s").html(hr_bpm(json['results']['5']['series']['0']['values']['0']['3']))
				}
			}
			// 1 min
			if (json['results']['6']['series']) {
				if (json['results']['6']['series']['0']['values']) {
					// min
					$("#min_hr_bpm_1m").html(hr_bpm(json['results']['6']['series']['0']['values']['0']['1']))
					// mean
					$("#mean_hr_bpm_1m").html(hr_bpm(json['results']['6']['series']['0']['values']['0']['2']))
					// max
					$("#max_hr_bpm_1m").html(hr_bpm(json['results']['6']['series']['0']['values']['0']['3']))
				}
			}
			// 5 min
			if (json['results']['7']['series']) {
				if (json['results']['7']['series']['0']['values']) {
					// min
					$("#min_hr_bpm_5m").html(hr_bpm(json['results']['7']['series']['0']['values']['0']['1']))
					// mean
					$("#mean_hr_bpm_5m").html(hr_bpm(json['results']['7']['series']['0']['values']['0']['2']))
					// max
					$("#max_hr_bpm_5m").html(hr_bpm(json['results']['7']['series']['0']['values']['0']['3']))
				}
			}
			// 10 min
			if (json['results']['8']['series']) {
				if (json['results']['8']['series']['0']['values']) {
					// min
					$("#min_hr_bpm_10m").html(hr_bpm(json['results']['8']['series']['0']['values']['0']['1']))
					// mean
					$("#mean_hr_bpm_10m").html(hr_bpm(json['results']['8']['series']['0']['values']['0']['2']))
					// max
					$("#max_hr_bpm_10m").html(hr_bpm(json['results']['8']['series']['0']['values']['0']['3']))
				}
			}
		}
		// cad_rpm
		if (json['results']['12']['series'] && json['results']['12']['series']['0']['values']['0']['2']){
			$("#mean").removeClass("hidden");
			$("#min").removeClass("hidden");
			$("#max").removeClass("hidden");
			$("#mean_cad_rpm").removeClass("hidden");
			$("#min_cad_rpm").removeClass("hidden");
			$("#max_cad_rpm").removeClass("hidden");
			if (!show_chart_cad_rpm) {
				chart_cad_rpm();
				show_chart_cad_rpm = true;
			}
			// 3 sec
			if (json['results']['9']['series']) {
				if (json['results']['9']['series']['0']['values']) {
					// min
					$("#min_cad_rpm_3s").html(cad_rpm(json['results']['9']['series']['0']['values']['0']['1']))
					// mean
					$("#mean_cad_rpm_3s").html(cad_rpm(json['results']['9']['series']['0']['values']['0']['2']))
					// max
					$("#max_cad_rpm_3s").html(cad_rpm(json['results']['9']['series']['0']['values']['0']['3']))
				}
			}
			// 1 min
			if (json['results']['10']['series']) {
				if (json['results']['10']['series']['0']['values']) {
					// min
					$("#min_cad_rpm_1m").html(cad_rpm(json['results']['10']['series']['0']['values']['0']['1']))
					// mean
					$("#mean_cad_rpm_1m").html(cad_rpm(json['results']['10']['series']['0']['values']['0']['2']))
					// max
					$("#max_cad_rpm_1m").html(cad_rpm(json['results']['10']['series']['0']['values']['0']['3']))
				}
			}
			// 5 min
			if (json['results']['11']['series']) {
				if (json['results']['11']['series']['0']['values']) {
					// min
					$("#min_cad_rpm_5m").html(cad_rpm(json['results']['11']['series']['0']['values']['0']['1']))
					// mean
					$("#mean_cad_rpm_5m").html(cad_rpm(json['results']['11']['series']['0']['values']['0']['2']))
					// max
					$("#max_cad_rpm_5m").html(cad_rpm(json['results']['11']['series']['0']['values']['0']['3']))
				}
			}
			// 10 min
			if (json['results']['12']['series']) {
				if (json['results']['12']['series']['0']['values']) {
					// min
					$("#min_cad_rpm_10m").html(cad_rpm(json['results']['12']['series']['0']['values']['0']['1']))
					// mean
					$("#mean_cad_rpm_10m").html(cad_rpm(json['results']['12']['series']['0']['values']['0']['2']))
					// max
					$("#max_cad_rpm_10m").html(cad_rpm(json['results']['12']['series']['0']['values']['0']['3']))
				}
			}
			// pwr_w
			if (json['results']['16']['series'] && json['results']['16']['series']['0']['values']['0']['2']){
				$("#mean").removeClass("hidden");
				$("#min").removeClass("hidden");
				$("#max").removeClass("hidden");
				$("#mean_pwr_w").removeClass("hidden");
				$("#min_pwr_w").removeClass("hidden");
				$("#max_pwr_w").removeClass("hidden");
				if (!show_chart_pwr_w) {
					chart_pwr_w();
					show_chart_pwr_w = true;
				}
				// 3 sec
				if (json['results']['13']['series']) {
					if (json['results']['13']['series']['0']['values']) {
						// min
						$("#min_pwr_w_3s").html(pwr_w(json['results']['13']['series']['0']['values']['0']['1']))
						// mean
						$("#mean_pwr_w_3s").html(pwr_w(json['results']['13']['series']['0']['values']['0']['2']))
						// max
						$("#max_pwr_w_3s").html(pwr_w(json['results']['13']['series']['0']['values']['0']['3']))
					}
				}
				// 1 min
				if (json['results']['14']['series']) {
					if (json['results']['14']['series']['0']['values']) {
						// min
						$("#min_pwr_w_1m").html(pwr_w(json['results']['14']['series']['0']['values']['0']['1']))
						// mean
						$("#mean_pwr_w_1m").html(pwr_w(json['results']['14']['series']['0']['values']['0']['2']))
						// max
						$("#max_pwr_w_1m").html(pwr_w(json['results']['14']['series']['0']['values']['0']['3']))
					}
				}
				// 5 min
				if (json['results']['15']['series']) {
					if (json['results']['15']['series']['0']['values']) {
						// min
						$("#min_pwr_w_5m").html(pwr_w(json['results']['15']['series']['0']['values']['0']['1']))
						// mean
						$("#mean_pwr_w_5m").html(pwr_w(json['results']['15']['series']['0']['values']['0']['2']))
						// max
						$("#max_pwr_w_5m").html(pwr_w(json['results']['15']['series']['0']['values']['0']['3']))
					}
				}
				// 10 min
				if (json['results']['16']['series']) {
					if (json['results']['16']['series']['0']['values']) {
						// min
						$("#min_pwr_w_10m").html(pwr_w(json['results']['16']['series']['0']['values']['0']['1']))
						// mean
						$("#mean_pwr_w_10m").html(pwr_w(json['results']['16']['series']['0']['values']['0']['2']))
						// max
						$("#max_pwr_w_10m").html(pwr_w(json['results']['16']['series']['0']['values']['0']['3']))
					}
				}
			}
		}
	}
}

// show altitude
chart_alt_m();

// first
query();

// reload every 3 sec
setInterval( function() {
	query();
}, 3000 );


</script>


</body>
</html>